<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Журнали</title>

    <style type="text/css">
       .description{
           font-family: Garamond;
           font-size: 22px;
           margin-left: 28%;
           width: 200px;
           padding: 20px;
       }
       table,td,th{
           border: 1px solid #ddd;
       }
       table {
           border-collapse: collapse;
           width: 40%;
           margin: 20px auto;
       }

       th, td {
           text-align: left;
           padding: 8px;
       }

       tr:nth-child(even){background-color: #f2f2f2}

       th {
           background-color: #4CAF50;
           color: white;
       }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>

    <div class="description" id="classTitle">Клас: </div>
    <div class="description" id="subjectTitle">Предмет: </div>
    <div class="description" id="teacherTitle">Вчитель: </div>

    <table id="table_mark">

    </table>

    <table id="table_home">
        <tr>
            <th>Дата</th>
            <th>Домашнє завдання</th>
            <th>Файл</th>
        </tr>
    </table>

    <script type="text/javascript">
    $(document).ready(function () {
        var weekStart = getFirstDayOfCurrentWeek();
        var pathArray = window.location.pathname.split('/');
        var idSubject = pathArray[3];
        var idClass = pathArray[5];
        $('<span>'+idClass+'</span>').appendTo('#classTitle');
        $('<span>'+idSubject+'</span>').appendTo('#subjectTitle');

       console.log(idSubject+" "+idClass)
        $.getJSON('http://localhost:8080/homeworks/subjects/'+idSubject+'/classes/'+idClass, function (data) {
            $.each(data, function(key, val) {
                var tr=$('<tr></tr>');
                $('<td>'+val.date+'</td>').appendTo(tr);
                $('<td>'+val.homework+'</td>').appendTo(tr);
                $('<td>'+val.file+'</td>').appendTo(tr);
                tr.appendTo('#table_home');
            });
        });

        $.getJSON('http://localhost:8080/journals/subjects/'+idSubject+'/classes/'+idClass,{weekStartDate:weekStart}, function (data) {
            $.each(data, function(key, val) {
                var tr1=$('<tr></tr>');
                var tr2=$('<tr></tr>');
                $('<th>'+"Тип оцінки"+'</th>').appendTo(tr1);
                $('<th>'+"Дата"+'</th>').appendTo(tr2);
                $.each(val.marks, function(k, v) {
                    $('<th>'+v.typeMark+'</th>').appendTo(tr1);
                    $('<th>'+v.dateMark+'</th>').appendTo(tr2);
                });
                $('<th>'+'AVG'+'</th>').appendTo(tr2);
                tr1.appendTo('#table_mark');
                tr2.appendTo('#table_mark');
                return false;
            });
            var countStudents = 0;
            var countMarks = 0;
            var sum=0;
            $.each(data, function(key, val) {
                var tr=$('<tr></tr>');
                $('<td>'+(++countStudents)+"."+val.studentFullName+'</td>').appendTo(tr);
                $.each(val.marks, function(k, v) {
                    if(!v.mark){
                        $('<td>'+""+'</td>').appendTo(tr);
                    }
                    else {
                        $('<td>' + v.mark + '</td>').appendTo(tr);
                        countMarks++;
                        sum+=v.mark;
                    }
                });
                $('<td>' + Math.round(sum/countMarks*100)/100 + '</td>').appendTo(tr);
                tr.appendTo('#table_mark');
            });
        });
        function getFirstDayOfCurrentWeek (){
            var weekStart = new Date();
            var currentDay = weekStart.getDay();
            weekStart.setDate(weekStart.getDate() - currentDay + 1);
            return weekStart;
        }
    });

    </script>
</body>
</html>